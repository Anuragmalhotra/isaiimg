<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>AI Image Detector - Train</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
	<style>
		:root { --bg: #0b0f13; --panel: #11161c; --text: #eaf0f6; --muted:#9fb0c3; --accent: #6ee7b7; --accent2:#38bdf8; --danger:#f43f5e; }
		* { box-sizing: border-box }
		html, body { height: 100% }
		body {
			margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
			background: radial-gradient(1200px 600px at 20% 0%, rgba(56,189,248,.15), transparent 45%),
				radial-gradient(1200px 600px at 80% 0%, rgba(110,231,183,.15), transparent 45%), var(--bg);
			color: var(--text);
		}
		.container { max-width: 880px; margin: 0 auto; padding: 56px 20px 80px }
		header { display: flex; align-items: center; justify-content: space-between; gap: 16px }
		.brand { display: flex; align-items: center; gap: 12px; font-weight: 700; font-size: 20px; letter-spacing: .3px }
		.brand-badge { width: 36px; height: 36px; border-radius: 12px; background: linear-gradient(135deg, var(--accent), var(--accent2)); display: grid; place-items: center; color: #0b0f13; font-weight: 800 }
		.panel { margin-top: 24px; background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border: 1px solid rgba(255,255,255,.08); border-radius: 16px; padding: 24px }
		.grid { display: grid; grid-template-columns: 1fr; gap: 24px }
		.controls { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; margin-top: 16px }
		button, .btn { appearance: none; border: 0; padding: 12px 16px; border-radius: 12px; cursor: pointer; font-weight: 600; color: #0b0f13; background: linear-gradient(180deg, var(--accent), #3ad2a1); box-shadow: 0 8px 24px rgba(110,231,183,.25) }
		.secondary { background: #1b242d; color: var(--text); box-shadow: inset 0 0 0 1px rgba(255,255,255,.12) }
		select, input[type="number"] { background: #0f141a; color: var(--text); border: 1px solid rgba(255,255,255,.12); border-radius: 10px; padding: 10px }
		.muted { color: var(--muted); font-size: 14px }
		.preview { width: 100%; aspect-ratio: 16/10; background: #0d1319; border-radius: 12px; display: grid; place-items: center; overflow: hidden; border: 1px solid rgba(255,255,255,.06) }
		.preview img { width: 100%; height: 100%; object-fit: contain }
		pre { background: #0f141a; color: #dbeafe; padding: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,.08); overflow: auto; max-height: 300px }
	</style>
</head>
<body>
	<div class="container">
		<header>
			<div class="brand"><div class="brand-badge">AI</div> Image Detector â€“ Train</div>
			<a class="btn secondary" href="/" rel="noreferrer">Back</a>
		</header>

		<div class="panel">
			<h2>Provide Feedback</h2>
			<p class="muted">Upload an image and tell the system whether it is AI or Real. Your feedback is saved and will be used for retraining.</p>
			<div class="grid">
				<div>
					<div id="preview" class="preview"><span class="muted">No image selected.</span></div>
					<div class="controls">
						<input id="file" type="file" accept="image/*" />
						<select id="label">
							<option value="AI">AI</option>
							<option value="Real">Real</option>
						</select>
						<button id="send">Send Feedback</button>
					</div>
					<p id="fbStatus" class="muted"></p>
				</div>
				<div>
					<h3>Train Model</h3>
					<div class="controls">
						<label>Arch:
							<select id="arch">
								<option value="efficientnet_b0">efficientnet_b0</option>
								<option value="resnet50">resnet50</option>
								<option value="vit_b_16">vit_b_16</option>
							</select>
						</label>
						<label>Epochs: <input id="epochs" type="number" value="8" min="1" max="50" /></label>
						<label><input id="unfreeze" type="checkbox" checked /> Fine-tune backbone</label>
						<button id="trainBtn">Start Training</button>
					</div>
					<p id="trainStatus" class="muted"></p>
					<h4>Training Logs (tail)</h4>
					<pre id="trainLogs" class="muted">No logs yet.</pre>
				</div>
			</div>
		</div>
	</div>

	<script>
	const fileEl = document.getElementById('file');
	const labelEl = document.getElementById('label');
	const preview = document.getElementById('preview');
	const fbStatus = document.getElementById('fbStatus');
	const trainStatus = document.getElementById('trainStatus');
	const archEl = document.getElementById('arch');
	const epochsEl = document.getElementById('epochs');
	const unfreezeEl = document.getElementById('unfreeze');
	const trainLogs = document.getElementById('trainLogs');

	document.getElementById('send').addEventListener('click', async () => {
		const f = fileEl.files && fileEl.files[0];
		if(!f){ fbStatus.textContent = 'Please choose an image.'; return; }
		fbStatus.textContent = 'Uploading feedback...';
		const form = new FormData();
		form.append('label', labelEl.value);
		form.append('file', f);
		try{
			const res = await fetch('/api/feedback', { method: 'POST', body: form });
			const data = await res.json();
			fbStatus.textContent = data.ok ? 'Saved feedback.' : ('Error: ' + (data.error || 'unknown'));
		}catch(err){ fbStatus.textContent = 'Error sending feedback.'; }
	});

	fileEl.addEventListener('change', e => {
		const f = fileEl.files && fileEl.files[0];
		if(!f){ preview.innerHTML = '<span class="muted">No image selected.</span>'; return; }
		const url = URL.createObjectURL(f);
		preview.innerHTML = `<img src="${url}" alt="preview">`;
	});

	document.getElementById('trainBtn').addEventListener('click', async () => {
		trainStatus.textContent = 'Starting training...';
		const form = new FormData();
		form.append('arch', archEl.value);
		form.append('epochs', String(Math.max(1, Math.min(50, parseInt(epochsEl.value||'8')))));
		form.append('unfreeze', String(unfreezeEl.checked));
		try{
			const res = await fetch('/api/train', { method: 'POST', body: form });
			const data = await res.json();
			if(data.ok){ trainStatus.textContent = 'Training started. This will take a while...'; }
			else { trainStatus.textContent = 'Training not started: ' + (data.status || 'unknown'); }
		}catch(err){ trainStatus.textContent = 'Error starting training.'; }
	});

	async function pollLogs(){
		try{
			const res = await fetch('/api/train_status');
			const data = await res.json();
			if(data.ok){
				trainLogs.textContent = (data.logTail || []).join('\n') || 'No logs yet.';
				if(data.running){ trainStatus.textContent = 'Training in progress...'; }
				else if(data.startedAt){ trainStatus.textContent = 'Training finished.'; }
			}
		}catch(e){ /* ignore */ }
	}
	setInterval(pollLogs, 2000);
	pollLogs();
	</script>
</body>
</html>
